{% extends 'Home/base.html' %}
{% load static %}

{% block content %}
    <!-- Background Section -->
    <div class="page-container" style="background-image: url('{% static 'cov.png' %}'); background-size: cover; background-position: center;">
        
        <!-- Content Section with Transparent Background -->
        <div class="container my-5 p-4 rounded shadow-sm" style="background-color: rgba(255, 255, 255, 0.8);">
            
            <!-- Top Section with Button -->
            <div class="top-section mb-4 text-center">
                <a href="{% url 'creer_trajet' %}" class="btn btn-primary px-4 py-2 rounded">Ajouter un nouveau trajet</a>
            </div>

            <h1 class="mb-4 text-center">Liste des Trajets</h1>

            <!-- Search Form -->
            <form method="GET" class="mb-4 p-4 bg-light rounded shadow-sm d-flex align-items-center">
                <div class="form-group mr-3">
                    <label for="point_depart" class="sr-only">Ville de Départ :</label>
                    <input type="text" id="point_depart" name="point_depart" class="form-control" placeholder="Ville de départ" value="{{ point_depart }}">
                </div>
            
                <div class="form-group mr-3">
                    <label for="point_arrivee" class="sr-only">Ville d'Arrivée :</label>
                    <input type="text" id="point_arrivee" name="point_arrivee" class="form-control" placeholder="Ville d'arrivée" value="{{ point_arrivee }}">
                </div>
            
                <div class="form-group mr-3">
                    <label for="date_depart" class="sr-only">Date de Départ :</label>
                    <input type="date" id="date_depart" name="date_depart" class="form-control" value="{{ date_depart }}">
                </div>
            
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>

            <!-- Traject Table -->
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Point de Départ</th>
                        <th>Point d'Arrivée</th>
                        <th>Date de Départ</th>
                        <th>Heure de Départ</th>
                        <th>Prix par Place</th>
                        <th>Places Disponibles</th>
                        <th>Statut</th>
                        <th>Conducteur</th>
                        <th>Contact</th>
                        <th>Matricule</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trajet in trajets %}
                        <tr class="{% if trajet.statut == 'annulé' %}annule{% endif %}">
                            <td>{{ trajet.point_depart }}</td>
                            <td>{{ trajet.point_arrivee }}</td>
                            <td>{{ trajet.date_depart }}</td>
                            <td>{{ trajet.heure_depart }}</td>
                            <td>{{ trajet.prix_par_place }} DT</td>
                            <td>{{ trajet.places_disponibles }}</td>
                            <td>
                                {% if trajet.places_disponibles == 0 %}
                                    <span class="complet">Complet</span>
                                {% else %}
                                    {{ trajet.statut }}
                                {% endif %}
                            </td>
                            <td>{{ trajet.conducteur_nom_complet }}</td>
                            <td>{{ trajet.conducteur_contact }}</td>
                            <td>{{ trajet.matricule }}</td>
                            <td class="actions">
                                {% if trajet.date_depart >= today %}
                                    <a href="{% url 'modifier_trajet' trajet.id %}" class="btn btn-warning btn-sm">Modifier</a>
                                    <a href="{% url 'supprimer_trajet' trajet.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce trajet ?');">Supprimer</a>
                                {% else %}
                                    <span>Non modifiable</span>
                                    <a href="{% url 'supprimer_trajet' trajet.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce trajet ?');">Supprimer</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="11" class="empty-message text-center">Aucun trajet disponible.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination Link -->
            <a href="{% url 'creer_trajet' %}" class="btn btn-link text-center d-block mt-4">
                Ajouter un nouveau trajet <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>
{% endblock %}
