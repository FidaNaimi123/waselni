{% extends 'Home/base.html' %}

{% block content %}
<div class="container mt-4">
    <h1>Mes Réservations</h1>

    <!-- Formulaire de recherche -->
    <form method="get" action="{% url 'user_reservations' %}">
        <div class="form-row">
            <div class="col">
                <input type="text" name="search" class="form-control" placeholder="Rechercher par trajet" value="{{ request.GET.search }}">
            </div>
            <div class="col">
                <input type="date" name="date" class="form-control" value="{{ request.GET.date }}">
            </div>
            <div class="col">
                <input type="time" name="hour" class="form-control" value="{{ request.GET.hour }}">
            </div>
             <!-- Bouton Rechercher avec une icône de recherche et un espacement à droite -->
             <button type="submit" class="btn btn-primary mr-2">
                <i class="fas fa-search"></i> Rechercher
            </button>
    
            <!-- Bouton Trier avec une icône de tri décroissant et un espacement à gauche -->
            <button type="submit" class="btn btn-secondary" name="sort" value="desc">
                <i class="fas fa-sort-amount-down"></i> Trier
            </button>
        </div>
    </form>

    <a href="{% url 'historique_reservations' %}">Historique</a>
    <p class="greeting">Bonjour, {{ user.email }} ! Voici vos réservations :</p>

    {% if reservations %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Trajet</th>
                    <th>Date de réservation</th>
                    <th>Nombre de sièges</th>
                    <th>Bagages</th>
                    <th>Méthode de paiement</th>
                    <th>Modifier</th>
                    <th>Supprimer</th>
                </tr>
            </thead>
            <tbody>
                {% for reservation in reservations %}
                    {% with today_date=today %}
                        {% if reservation.trip_id.date_depart < today_date %}
                            <tr>
                                <td>{{ reservation.trip_id }}</td>
                                <td>{{ reservation.reservation_date }}</td>
                                <td>{{ reservation.seat_count }}</td>
                                <td>{{ reservation.Baggage|yesno:"Oui,Non" }}</td>
                                <td>{{ reservation.Payment_Method }}</td>
                                <td class="table-actions">
                                    <span class="btn-disabled">Modifier</span>
                                </td>
                                <td class="table-actions">
                                    <span class="btn-disabled">Supprimer</span>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td>{{ reservation.trip_id }}</td>
                                <td>{{ reservation.reservation_date }}</td>
                                <td>{{ reservation.seat_count }}</td>
                                <td>{{ reservation.Baggage|yesno:"Oui,Non" }}</td>
                                <td>{{ reservation.Payment_Method }}</td>
                                <td class="table-actions">
                                    <a href="{% url 'update_reservation' reservation.id %}" class="btn btn-primary">Modifier</a>
                                </td>
                                <td class="table-actions">
                                    <a href="{% url 'delete_reservation' reservation.id %}" class="btn btn-danger" onclick="return confirm('Voulez-vous vraiment supprimer cette réservation ?');">Supprimer</a>
                                </td>
                            </tr>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="no-reservations">Vous n'avez pas encore de réservations.</p>
    {% endif %}
</div>
{% endblock %}


